{% extends 'base.html' %}

{% block title %}Notifications{% endblock %}

{% block include_scripts_top %}
<script src="/static/js/site.js" type="text/javascript"></script>

<script type="text/javascript">
    if ('serviceWorker' in navigator && 'PushManager' in window) {
      navigator.serviceWorker.register("{{ url_for('static', filename='js/service-worker.js')}}").then(
        function (serviceWorkerRegistration) {
          serviceWorkerRegistration.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: '{{application_server_key}}'
          }).then(
            function (pushSubscription) {
              $.ajax({
                url: '/subscription',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(pushSubscription),
                dataType: 'json'
              });
            }, function (error) {
              console.log('error = ' + error);
            }
          );
        }
      );
    }
</script>

<script type="text/javascript">
  function render_notifications(data) {
    let $table = $('#table_notifications');
    $table.find("tbody tr").remove();
    $.each(data.results, function () {
      $table.append(
          "<tr>" +
          "<td>" + this.message + "</td>" +
          "<td style='width: 140px'>" + this.created_on + "</td>" +
          "</tr>"
      );
    });
  }
</script>

<script type="text/javascript">
  function render_rules(data) {
    let $table = $('#table_rules');
    $table.find("tbody tr").remove();
    $.each(data.results, function () {
      $table.append(
          "<tr>" +
          "<td>" + this.coin_token + "</td>" +
          "<td>" + this.metric + "</td>" +
          "<td>" + this.interval + "</td>" +
          "<td class='align-right'>" + this.percentage + "%</td>" +
          "<td style='width: 140px'>" + this.created_on + "</td>" +
          "</tr>"
      );
    });
  }
</script>

<script type="text/javascript">
  $(document).ready(function() {
    get_notifications(render_notifications);
    get_rules(render_rules);
  });
</script>

<script type="text/javascript">
    $(document).ready(function() {
      $(".navbar-countdown").hide();
    });
</script>
{% endblock %}

{% block body %}

{% with url='ticker.ticker', params=dict() %}
{% include 'snippets/menu.html' %}
{% endwith %}

<br/><br/>

<div class="row">
    <div class="six columns">
      <div style="float: left">
        <h5>My Rules</h5>
      </div>
      <div style="float: right">
        <input class="button-primary" type="button" value="Add Rule" onClick="(
          function() {
            open_modal('#rule');
            return false;
          })(); return false;">
      </div>

      <table class="u-full-width" id="table_rules">
        <thead>
          <tr>
            <th>Coin/Token</th>
            <th>Metric</th>
            <th>Interval</th>
            <th>Perc. %</th>
            <th>Added On UTC</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

  </div>

  <div class="six columns">
    <div style="float: left;">
      <h5>My Notifications</h5>
    </div>

    <table class="u-full-width" id="table_notifications">
      <thead>
        <tr>
          <th>Notification</th>
          <th>Sent On UTC</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    </div>
</div>

{% include 'modals/rule.html' %}

{% endblock %}
